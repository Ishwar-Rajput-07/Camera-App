<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap By SKILLHUB</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>

<body>


    <div class="container  d-flex justify-content-center gap-3 align-items-end pb-5 vh-100 ">

        <!-- <div class="spinner-border text-dark"></div> -->
        <button id="start" type="button" class="btn bt-gl btn-primary ">Start Camera </button>
        <button id="capture" type="button" class="btn btn-primary d-none">Capture <i class="bi bi-camera"></i></button>
        <button id="close" type="button" class="btn btn-warning d-none">Close <i class="bi bi-telephone-x"></i></button>
    </div>

    <div class="position-absolute top-50 start-50 translate-middle ">
        <div id="loader" class="d-flex align-items-center gap-2"></div>
        <video height="200px" class="d-none" autoplay controls id="player"></video>
    </div>

    <div class=" position-absolute" style="top: 50px; right: 50px;">
        <button type="button" id="switchCamera" class="btn btn-outline-dark btn-lg d-none">
            <i class="bi bi-camera2"></i>
        </button>

    </div>

    <script>

        const startBtn = document.getElementById("start")
        const captureBtn = document.getElementById("capture")
        const closeBtn = document.getElementById("close")
        const player = document.getElementById("player")



        const switchBtn = document.getElementById("switchCamera")

        let mode = "user"
        switchBtn.addEventListener("click", () => {
            mode = mode === "environment" ? "user" : "environment"
            player.classList.add("d-none")
            const tracks = player.srcObject.getVideoTracks()
            for (let i = 0; i < tracks.length; i++) {
                tracks[i].stop()
            }
            openCamera()
        })


        startBtn.addEventListener("click", async () => {
            openCamera()
        })
        captureBtn.addEventListener("click", () => {
            console.log("capture buttun clicked");
            startBtn.classList.remove("d-none")

        })
        closeBtn.addEventListener("click", () => {
            console.log("cloce buttun clicked");

            console.log(player.srcObject.getVideoTracks());
            const tracks = player.srcObject.getVideoTracks()
            for (let i = 0; i < tracks.length; i++) {
                tracks[i].stop()
            }

            captureBtn.classList.add("d-none")
            closeBtn.classList.add("d-none")
            startBtn.classList.remove("d-none")
            player.classList.add("d-none")
            switchBtn.classList.add("d-none")



        })

        const openCamera = async () => {
            // handleCamera Start
            if (navigator.mediaDevices) {
                document.getElementById("loader").innerHTML = `
               opening camare <div class="spinner-border text-dark" ></div>
            `
                startBtn.setAttribute("disabled", true)
                try {
                    const x = await navigator.mediaDevices.getUserMedia({
                        video: {
                            // facingMode:"user"
                            facingMode: mode
                        },

                    })
                    player.srcObject = x
                } catch (error) {
                    console.log(ERROR);
                }
                document.getElementById("loader").innerHTML = ""
                startBtn.removeAttribute("disabled")

            } else {
                console.error("mediaDevices not supported");
            }

            captureBtn.classList.remove("d-none")
            closeBtn.classList.remove("d-none")
            startBtn.classList.add("d-none")
            player.classList.remove("d-none")
            switchBtn.classList.remove("d-none")



            // handleCamera end
            // player.setAttribute("src", "./1.mp4")
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>